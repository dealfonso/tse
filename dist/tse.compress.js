/* Copyright 2025 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
{if(window,"undefined"==typeof window)throw new Error("This script must be executed in a browser environment.");let i={},o={attributePrefix:"data-tse-bind-",templateDelimiter:/\${([^}]*)}/g,evalContext:window,observeMutations:!0,debounceTime:10,disableAttribute:"data-tse-disable"},a=null,u={textContent:Object.getOwnPropertyDescriptor(Node.prototype,"textContent"),innerHTML:Object.getOwnPropertyDescriptor(Element.prototype,"innerHTML"),setAttribute:Element.prototype.setAttribute};function d(e){if(e.nodeType!==Node.ELEMENT_NODE)return!(e.nodeType!==Node.TEXT_NODE||!e.parentElement)&&d(e.parentElement);if(e.hasAttribute(o.disableAttribute))return!0;let t=e.parentElement;for(;t;){if(t.hasAttribute(o.disableAttribute))return!0;t=t.parentElement}return!1}function r(t,e){try{var n={...e||{},...i};return new Function("context",`with(context) { return ${t}; }`)(n)}catch(e){return console.error(`Error evaluating expression "${t}":`,e),`[Error: ${e.message}]`}}function s(e){return"string"==typeof e&&o.templateDelimiter.test(e)?(o.templateDelimiter.lastIndex=0,e.replace(o.templateDelimiter,(e,t)=>{t=r(t);return void 0!==t?t:e})):e}function l(e){var t,n;d(e)||(t=e.nodeValue,o.templateDelimiter.test(t)&&(o.templateDelimiter.lastIndex=0,(n=t.replace(o.templateDelimiter,(e,t)=>{t=r(t);return void 0!==t?t:e}))!==t)&&(e.nodeValue=n))}function c(n){d(n)||Array.from(n.attributes).forEach(e=>{var t;e.name.startsWith(o.attributePrefix)&&(t=e.name.substring(o.attributePrefix.length),e=r(e.value),n[t]=e)})}function E(e=document.body){if(e.nodeType!==Node.ELEMENT_NODE||!d(e))for(var t,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,{acceptNode:function(e){return e.nodeType===Node.ELEMENT_NODE&&d(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},!1);t=n.nextNode();)t.nodeType===Node.TEXT_NODE?l(t):t.nodeType===Node.ELEMENT_NODE&&c(t)}window.DOMTemplateStringEvaluator={init:function(e={}){let t={...o},n=(o={...o,...e},e.evalContext&&Object.assign(i,e.evalContext),"loading"!==document.readyState),r=()=>{if(o.observeMutations){if((!a||t.debounceTime!==o.debounceTime||!t.observeMutations)&&window.MutationObserver){a&&(a.disconnect(),a=null);let t,e=new MutationObserver(e=>{clearTimeout(t),t=setTimeout(()=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&d(e)||(e.nodeType===Node.TEXT_NODE?l(e):e.nodeType===Node.ELEMENT_NODE&&(c(e),E(e)))}),"attributes"===e.type&&(e.attributeName===o.disableAttribute?e.target.hasAttribute(o.disableAttribute)||(c(e.target),E(e.target)):d(e.target)||c(e.target)),"characterData"!==e.type||d(e.target)||l(e.target)})},o.debounceTime)});e.observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),a=e}}else a&&(a.disconnect(),a=null)};return n?(E(),r()):document.addEventListener("DOMContentLoaded",()=>{E(),r()}),Object.defineProperty(Node.prototype,"textContent",{get:u.textContent.get,set:function(e){return this.nodeType===Node.ELEMENT_NODE&&d(this)?u.textContent.set.call(this,e):(e=s(e),u.textContent.set.call(this,e))},configurable:!0}),Object.defineProperty(Element.prototype,"innerHTML",{get:u.innerHTML.get,set:function(e){return d(this)?u.innerHTML.set.call(this,e):(e=s(e),u.innerHTML.set.call(this,e))},configurable:!0}),Element.prototype.setAttribute=function(e,t){return d(this)&&e!==o.disableAttribute||"string"==typeof t&&(t=s(t)),u.setAttribute.call(this,e,t)},this},scan:function(e=document.body){return E(e),this},addToContext:function(e){return Object.assign(i,e),this},evaluate:function(e){return r(e,o.evalContext)},evaluateText:s,setContent:function(e,t,n="text"){t=this.evaluateText(t);return"html"===n?e.innerHTML=t:e.textContent=t,this},getConfig:function(){return{...o}},getVersion:function(){return"1.0.1"},destroy:function(){a&&(a.disconnect(),a=null),Object.defineProperty(Node.prototype,"textContent",u.textContent),Object.defineProperty(Element.prototype,"innerHTML",u.innerHTML),Element.prototype.setAttribute=u.setAttribute},isDisabled:d,enable:function(e){return e&&e.nodeType===Node.ELEMENT_NODE&&(e.removeAttribute(o.disableAttribute),E(e)),this},disable:function(e){return e&&e.nodeType===Node.ELEMENT_NODE&&e.setAttribute(o.disableAttribute,""),this}},"loading"!==document.readyState?DOMTemplateStringEvaluator.init():document.addEventListener("DOMContentLoaded",function(){DOMTemplateStringEvaluator.init()})}