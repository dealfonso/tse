/* Copyright 2025 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
{if(window,"undefined"==typeof window)throw new Error("This script must be executed in a browser environment.");let o={},i={attributePrefix:"data-bind-",templateDelimiter:/\${([^}]*)}/g,evalContext:window,observeMutations:!0,debounceTime:10},a=null,u={textContent:Object.getOwnPropertyDescriptor(Node.prototype,"textContent"),innerHTML:Object.getOwnPropertyDescriptor(Element.prototype,"innerHTML"),setAttribute:Element.prototype.setAttribute};function r(t,e){try{var n={...e||{},...o};return new Function("context",`with(context) { return ${t}; }`)(n)}catch(e){return console.error(`Error evaluating expression "${t}":`,e),`[Error: ${e.message}]`}}function l(e){return"string"==typeof e&&i.templateDelimiter.test(e)?(i.templateDelimiter.lastIndex=0,e.replace(i.templateDelimiter,(e,t)=>{t=r(t);return void 0!==t?t:e})):e}function d(e){var t,n=e.nodeValue;i.templateDelimiter.test(n)&&(i.templateDelimiter.lastIndex=0,(t=n.replace(i.templateDelimiter,(e,t)=>{t=r(t);return void 0!==t?t:e}))!==n)&&(e.nodeValue=t)}function c(n){Array.from(n.attributes).forEach(e=>{var t;e.name.startsWith(i.attributePrefix)&&(t=e.name.substring(i.attributePrefix.length),e=r(e.value),n[t]=e)})}function s(e=document.body){for(var t,n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,null,!1);t=n.nextNode();)t.nodeType===Node.TEXT_NODE?d(t):t.nodeType===Node.ELEMENT_NODE&&c(t)}window.DOMTemplateStringEvaluator={init:function(e={}){let t={...i},n=(i={...i,...e},e.evalContext&&Object.assign(o,e.evalContext),"loading"!==document.readyState),r=()=>{if(i.observeMutations){if((!a||t.debounceTime!==i.debounceTime||!t.observeMutations)&&window.MutationObserver){a&&(a.disconnect(),a=null);let t,e=new MutationObserver(e=>{clearTimeout(t),t=setTimeout(()=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e.nodeType===Node.TEXT_NODE?d(e):e.nodeType===Node.ELEMENT_NODE&&(c(e),s(e))}),"attributes"===e.type&&c(e.target),"characterData"===e.type&&d(e.target)})},i.debounceTime)});e.observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),a=e}}else a&&(a.disconnect(),a=null)};return n?(s(),r()):document.addEventListener("DOMContentLoaded",()=>{s(),r()}),Object.defineProperty(Node.prototype,"textContent",{get:u.textContent.get,set:function(e){e=l(e);return u.textContent.set.call(this,e)},configurable:!0}),Object.defineProperty(Element.prototype,"innerHTML",{get:u.innerHTML.get,set:function(e){e=l(e);return u.innerHTML.set.call(this,e)},configurable:!0}),Element.prototype.setAttribute=function(e,t){return"string"==typeof t&&(t=l(t)),u.setAttribute.call(this,e,t)},this},scan:function(e=document.body){return s(e),this},addToContext:function(e){return Object.assign(o,e),this},evaluate:function(e){return r(e,i.evalContext)},evaluateText:l,setContent:function(e,t,n="text"){t=this.evaluateText(t);return"html"===n?e.innerHTML=t:e.textContent=t,this},getConfig:function(){return{...i}},getVersion:function(){return"1.0.0"},destroy:function(){a&&(a.disconnect(),a=null),Object.defineProperty(Node.prototype,"textContent",u.textContent),Object.defineProperty(Element.prototype,"innerHTML",u.innerHTML),Element.prototype.setAttribute=u.setAttribute}},"loading"!==document.readyState?DOMTemplateStringEvaluator.init():document.addEventListener("DOMContentLoaded",function(){DOMTemplateStringEvaluator.init()})}