/* Copyright 2025 Carlos A. (https://github.com/dealfonso); License: https://opensource.org/license/mit/ */
(function(t){"use strict";if(typeof window==="undefined"){throw new Error("This script must be executed in a browser environment.")}const e="1.0.1";const i={};const n={attributePrefix:"data-tse-bind-",templateDelimiter:/\${([^}]*)}/g,evalContext:window,observeMutations:true,debounceTime:10,disableAttribute:"data-tse-disable"};let o={...n};let u=null;const r={textContent:Object.getOwnPropertyDescriptor(Node.prototype,"textContent"),innerHTML:Object.getOwnPropertyDescriptor(Element.prototype,"innerHTML"),setAttribute:Element.prototype.setAttribute};function s(t){if(t.nodeType!==Node.ELEMENT_NODE){if(t.nodeType===Node.TEXT_NODE&&t.parentElement){return s(t.parentElement)}return false}if(t.hasAttribute(o.disableAttribute)){return true}let e=t.parentElement;while(e){if(e.hasAttribute(o.disableAttribute)){return true}e=e.parentElement}return false}function a(e,t){try{const n={...t||{},...i};const r=new Function("context",`with(context) { return ${e}; }`);return r(n)}catch(t){console.error(`Error evaluating expression "${e}":`,t);return`[Error: ${t.message}]`}}function l(t){if(typeof t!=="string"||!o.templateDelimiter.test(t))return t;o.templateDelimiter.lastIndex=0;return t.replace(o.templateDelimiter,(t,e)=>{const n=a(e);return n!==undefined?n:t})}function c(t){if(s(t))return;const e=t.nodeValue;if(!o.templateDelimiter.test(e))return;o.templateDelimiter.lastIndex=0;const n=e.replace(o.templateDelimiter,(t,e)=>{const n=a(e);return n!==undefined?n:t});if(n!==e){t.nodeValue=n}}function d(r){if(s(r))return;Array.from(r.attributes).forEach(t=>{if(t.name.startsWith(o.attributePrefix)){const e=t.name.substring(o.attributePrefix.length);const n=a(t.value);r[e]=n}})}function f(t=document.body){if(t.nodeType===Node.ELEMENT_NODE&&s(t)){return}const e=document.createTreeWalker(t,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,{acceptNode:function(t){if(t.nodeType===Node.ELEMENT_NODE&&s(t)){return NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT}},false);let n;while(n=e.nextNode()){if(n.nodeType===Node.TEXT_NODE){c(n)}else if(n.nodeType===Node.ELEMENT_NODE){d(n)}}}function E(){if(!window.MutationObserver)return null;if(u){u.disconnect();u=null}let e;const t=new MutationObserver(t=>{clearTimeout(e);e=setTimeout(()=>{t.forEach(t=>{t.addedNodes.forEach(t=>{if(t.nodeType===Node.ELEMENT_NODE&&s(t)){return}if(t.nodeType===Node.TEXT_NODE){c(t)}else if(t.nodeType===Node.ELEMENT_NODE){d(t);f(t)}});if(t.type==="attributes"){if(t.attributeName===o.disableAttribute){if(!t.target.hasAttribute(o.disableAttribute)){d(t.target);f(t.target)}}else if(!s(t.target)){d(t.target)}}if(t.type==="characterData"){if(!s(t.target)){c(t.target)}}})},o.debounceTime)});t.observe(document.body,{childList:true,attributes:true,characterData:true,subtree:true});u=t;return t}function b(){Object.defineProperty(Node.prototype,"textContent",{get:r.textContent.get,set:function(t){if(this.nodeType===Node.ELEMENT_NODE&&s(this)){return r.textContent.set.call(this,t)}const e=l(t);return r.textContent.set.call(this,e)},configurable:true});Object.defineProperty(Element.prototype,"innerHTML",{get:r.innerHTML.get,set:function(t){if(s(this)){return r.innerHTML.set.call(this,t)}const e=l(t);return r.innerHTML.set.call(this,e)},configurable:true});Element.prototype.setAttribute=function(t,e){if(s(this)&&t!==o.disableAttribute){return r.setAttribute.call(this,t,e)}if(typeof e==="string"){e=l(e)}return r.setAttribute.call(this,t,e)}}function p(){Object.defineProperty(Node.prototype,"textContent",r.textContent);Object.defineProperty(Element.prototype,"innerHTML",r.innerHTML);Element.prototype.setAttribute=r.setAttribute}window.DOMTemplateStringEvaluator={init:function(t={}){const e={...o};o={...o,...t};if(t.evalContext){Object.assign(i,t.evalContext)}const n=document.readyState!=="loading";const r=()=>{if(o.observeMutations){if(!u||e.debounceTime!==o.debounceTime||!e.observeMutations){E()}}else if(u){u.disconnect();u=null}};if(n){f();r()}else{document.addEventListener("DOMContentLoaded",()=>{f();r()})}b();return this},scan:function(t=document.body){f(t);return this},addToContext:function(t){Object.assign(i,t);return this},evaluate:function(t){return a(t,o.evalContext)},evaluateText:function(t){return l(t)},setContent:function(t,e,n="text"){const r=this.evaluateText(e);if(n==="html"){t.innerHTML=r}else{t.textContent=r}return this},getConfig:function(){return{...o}},getVersion:function(){return e},destroy:function(){if(u){u.disconnect();u=null}p()},isDisabled:function(t){return s(t)},enable:function(t){if(t&&t.nodeType===Node.ELEMENT_NODE){t.removeAttribute(o.disableAttribute);f(t)}return this},disable:function(t){if(t&&t.nodeType===Node.ELEMENT_NODE){t.setAttribute(o.disableAttribute,"")}return this}};if(document.readyState!=="loading"){DOMTemplateStringEvaluator.init()}else{document.addEventListener("DOMContentLoaded",function(){DOMTemplateStringEvaluator.init()})}})(window);